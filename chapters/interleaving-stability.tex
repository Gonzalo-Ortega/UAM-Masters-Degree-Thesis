\chapter{Interleaving Stability Theorem} \label{chap:interleaving-stability}
This Chapter gives a detailed proof of the first stability theorem for persistence homology. This theorem is referred to as the ``Geometry miracle'' of persistent homology, as it allows to describe an isometry between persistence modules and barcodes \cite{nanda}. This shows that {\it small} changes in a data sets will perform {\it small} changes in their persistence modules, and therefore small changes in how persistent homology groups vary through time. The theorem claims that given two persistence modules, the distance between them using the interleaving distance, is the same as the distance between their barcodes using the bottleneck distance.

\begin{restatable}[Interleaving Stability, Theorem 2.2.8, \cite{polterovich}]{theorem}{Stability} \label{theorem:stability}
    There is an isometry between a persistence module with the interleaving distance and its barcode with the bottleneck distance. That is, given two persistence modules $ V $ and $ W $, it holds that
    \begin{equation}
        \di (V, W) = \db (\barc(V), \barc(W)).
    \end{equation} 
\end{restatable}

For the presented proof we have followed \cite{polterovich}. Hence, we will divide the proof into proving two complementary inequalities separately. This implies checking that if there exists a $\delta$-matching between two given barcodes, then there exists a $\delta$-interleaving morphism between their persistence modules, Proposition \ref{prop:interleaving-if-matching}. Also, we need to check that, if there exists a $\delta$-interleaving morphism between two persistence modules, then there exists a $\delta$-matching between their barcodes, \ref{prop:matching-if-interleaving}.

\section{First inequality}

The first claim can be deduced from the Structure Theorem \ref{theorem:structure} in a rather direct way, proving first the case where our modules are just interval modules.

\begin{lemma}[Exercise 2.2.7, \cite{polterovich}] \label{lemma:interval-interleaving-if-matching}
    Let $ I, J $ be two $\delta$-matched intervals. Then, their corresponding interval modules $ (\mathbb F (I), \pi) $ and $( \mathbb F (J), \theta) $ are $\delta$-interleaved.
\end{lemma}
\begin{proof}
    Let $ I = (a, b] $, $ J = (c, d] $. If $\rho$ is the $\delta$-matching between them, then $ \rho(I) = J $ and, following Definition \ref{delta-matching}, $ (a, b] \subseteq (c-\delta, d+\delta] $ and $ (c, d] \subseteq (a-\delta, b+\delta] $, with $ b - a > 2\delta $ and $ d - c > 2\delta $. Then, the morphisms
    \begin{equation*}
        \begin{aligned}[c]
        \phi_\delta\colon \mathbb F(I) &\to \mathbb F(J)_\delta\\
        \phi_\delta(\mathbb F(I)_t) &\mapsto \mathbb F(J)_{(t+\delta)}\\
        \end{aligned}
        \quad \text{and} \quad
        \begin{aligned}[c]
        \psi_\delta\colon \mathbb F(J) &\to \mathbb F(I)_\delta\\
        \psi_\delta(\mathbb F(J)_t) &\mapsto \mathbb F(I)_{(t+\delta)}\\
        \end{aligned}
    \end{equation*}
    are well defined as for any $ t \in (a,b], \ t + \delta \in (c, d] $, as $ a + \delta > c $ and $ b + \delta \leq d $. In the same way, for any $ t \in (c,d], \ t + \delta \in (a, b] $. Thus,
    \begin{equation}
        \psi_\delta \circ \phi_\delta (\mathbb F(I)_t) = \psi_\delta(\mathbb F(J)_{(t+\delta)}) = \mathbb F(I)_{(t+2\delta)} = \pi_{t \leq t+2\delta}(\mathbb F(I)_t).
    \end{equation}
    and
    \begin{equation}
        \phi_\delta \circ \psi_\delta (\mathbb F(J)_t) = \phi_\delta(\mathbb F(I)_{(t+\delta)}) = \mathbb F(J)_{(t+2\delta)} = \theta_{t \leq t+2\delta}(\mathbb F(J)_t).
    \end{equation}
    Therefore, $ \phi_\delta $ and $ \psi_\delta $ are a pair of $\delta$-interleaving morphisms.
\end{proof}

Once we are able to build a $\delta$-interleaving between two $\delta$-matched interval modules, we will use the Structure Theorem for persistence modules to generalice the construction for arbitrary persistence modules. This will be useful to prove the first inequality needed to prove Theorem \ref{theorem:stability}.

\begin{proposition}[Theorem 3.0.1, \cite{polterovich}]\label{prop:interleaving-if-matching} 
    Given two persistence modules $ V $, $ W $, if there is a $ \delta$-matching between their barcodes, then there is a $ \delta$-interleaving morphism between them.
\end{proposition}
\begin{proof}
    Suppose that $\rho\colon \barc (V) \to \barc (W) $ is a $\delta$-matching between the barcodes of $ V $ and $ W $. By the Structure Theorem \ref{theorem:structure}, $ V $ and $ W $ decompose in a finite direct sum of interval modules
    \begin{align}
        V \cong \! \bigoplus_{I \in \barc (V)} \mathbb F (I),& &W \cong \! \bigoplus_{J \in  \barc (W)} \mathbb F (J) .
    \end{align}
    We can express $ V = V_Y \oplus V_N $, $ W = W_Y \oplus W_N $ denoting
    \begin{align}
        V_Y &\cong \bigoplus_{I \in  \operatorname{coim} \rho} \mathbb F (I),& V_N \cong &\bigoplus_{I \in \barc(V) \backslash \operatorname{coim} \rho} \mathbb F (I),\\
        W_Y &\cong \bigoplus_{J \in  \im \rho} \mathbb F (J),& W_N \cong &\bigoplus_{J \in \barc(J) \backslash \im \rho} \mathbb F (J).
    \end{align}
    The $ V_Y, W_Y $ modules separate the ``yes, matched'' intervals, from the $ V_N, W_N $ ``not matched" intervals. For every interval $ I \in \barc(V_Y) $, $ I $ is $\delta$-matched to an interval $ J \in \barc(W_Y)$ by $\rho(I) = J $. Thus, by Lemma \ref{lemma:interval-interleaving-if-matching}, for all pair $ I, J $ of matched intervals, there exist a par of $\delta$-interleaved morphisms
    \begin{equation*}
        \begin{aligned}[c]
        \phi_\delta\colon \mathbb F(I) &\to \mathbb F(J)_\delta\\
        \end{aligned}
        \quad \text{and} \quad
        \begin{aligned}[c]
        \psi_\delta\colon \mathbb F(J) &\to \mathbb F(I)_\delta\\
        \end{aligned}
    \end{equation*}
    which induce the pair of $\delta$-interleaved morphisms
    \begin{equation*}
        \begin{aligned}[c]
        \phi_\delta\colon V_Y &\to {W_Y}_\delta\\
        \end{aligned}
        \quad \text{and} \quad
        \begin{aligned}[c]
        \psi_\delta\colon W_Y &\to {V_Y}_\delta.\\
        \end{aligned}
    \end{equation*}
    Not matched intervals are of length smaller than $ 2 \delta $, therefore both, $V_N$ and $V_Y$ are $\delta$-interleaved with the empty set. We can now construct the $\delta$-interleaving morphism $ \phi\colon V \to W$ such as $\phi \vert_{V_Y} = \phi_Y$ and $\phi \vert_{V_N} = 0$. In a similar way, we also construct $ \psi\colon W \to V$.
\end{proof}

\section{Second inequality}

With Proposition \ref{prop:interleaving-if-matching} we have proven the first half of Stability Theorem \ref{theorem:stability}. Now we need to prove that we can build a $\delta$-interleaving morphism from a $\delta$-matching. To verify this claim we need several previous lemmas that will lead us to prove Proposition \ref{prop:interleaving-if-matching}.

First, we will introduce some notation. Let $(V, \pi)$, $(W, \theta)$ be two persistence modules and let $ I = (b, d]$ be an interval with $ d \in \R \cup \{+ \infty\}$. Denote the set of bars of $\barc(V)$ that start before $b$ and end exactly at $d$ as
$$
    \barc_{I-}(V) \coloneq \left\{ (a, d] \in \barc(V) \colon a \leq b\right\}.
$$
Analogously, denote the set of bars that start at $b$ and end after $d$ as
$$
    \barc_{I+}(V) \coloneq \left\{ (b, c] \in \barc(V) \colon c \geq d\right\}.
$$

\begin{lemma}[Proposition 3.1.1, \cite{polterovich}] \label{lemma:inj-cardinalities}
    Let $ I = (b, d] $ be an interval. If there exists an injective morphism $\iota \colon (V, \pi) \to (W, \theta) $, then $\#(\barc_{I-}(V)) \leq \#(\barc_{I-}(W)) $. Where $ \#(\cdot) $ denotes the cardinal operator.
\end{lemma}
\begin{proof}
    For $ b < s < d < r $, denote the set of elements in $ V_d $ witch come from all $ V_s $ and disappear in all $ V_r $ as
    $$
        E_{I-} = \bigcap_{b < s < d} \im \pi_{s\leq d} \cap \bigcap_{r> d} \ker \pi_{d \leq r} \subseteq V_d.
    $$
    It holds that $ \dim E_{I-}(V) = \#(\barc_{I-}(V)) $. For every morphism $ p\colon (V, \pi) \to (W, \theta) $ the following diagram conmutes
    $$
    \begin{tikzcd}
        V_s \arrow[r, "\pi_{s \leq r}"] \arrow[d, "p_s"'] & V_r \arrow[d, "p_r"] \\
        W_s \arrow[r, "\theta_{s \leq r}"']               & W_r
    \end{tikzcd}
    $$
    This implies that
    \begin{align}
        p_r(\im \pi_{s \leq r}) \subseteq \im \theta_{s \leq r}, & & p_s(\ker \pi_{s \leq r}) \subseteq \ker \theta_{s \leq r}.
    \end{align}
    Taking $ r = d $, $ b < s < d $ in the first inclusion, and $ s = d $, $ r > d $ in the second, we have that
    \begin{align}
        p_d(\im \pi_{s \leq d}) \subseteq \im \theta_{s \leq d}, & & p_d(\ker \pi_{d \leq r}) \subseteq \ker \theta_{d \leq r},
    \end{align}
    and 
    $$
        p_d(E_{I-}(V)) \subseteq E_{I-}(W).
    $$
    If we now take $ p $ as the injective morphism of the hypothesis, $ p = \iota $, we get
    $$
        \dim E_{I-}(V) \leq \dim E_{I-}(W).
    $$
\end{proof}
 
\begin{lemma}[Exercise 3.1.3, \cite{polterovich}] \label{lemma:sur-cardinalities}
    Let $ I = (b, d] $ be an interval. Suppose there exists a surjective morphism $s\colon (V, \pi) \to (W, \theta) $. Then $\#(\barc_{I+}(V)) \geq \#(\barc_{I+}(W)) $.
\end{lemma}
\begin{proof}
    Analogously to the proof of Lemma \ref{lemma:inj-cardinalities} we now define
    $$
        E_{I+}(V) = \bigcap \im \pi_{d \leq r}.
    $$
    Therefore $ \dim E_{I+}(V) = \#(\barc_{I+}(V)) $, and recalling the diagram used for the previous proof, and using the fact that is commutative, we have that
    $$
        p_r(\im \pi_{s \leq r}) \supseteq \im \theta_{s \leq r}.
    $$
    Taking $ s = d $ we then have that
    $$
        p_d(E_{I+}(V)) \supseteq E_{I+}(W).
    $$
    And finally, taking the surjective morphism $ p = s $ we have that
    $$
        \dim E_{I-}(V) \geq \dim E_{I-}(W).
    $$
\end{proof}

To build our $\delta$-matching we first define two induced matchings, by an injection and by a surjection respectively. First, suppose that there exists an injection $\iota \colon V \to W$. For every $ c \in \R \cup \{\infty\}$, sort the bars $(a_i, c] \in \barc(V) $, $i \in \{1, \dots, k\} $ by decreasing length order,
$$
    (a_1, c] \supseteq (a_2, c] \supseteq \cdots \supseteq (a_k, c] \text{, with } a_1 \leq a_2 \leq \dots \leq a_k.
$$
Sort in the same manner the bars $(b_j, c] \in \barc(V) $, $j \in \{1, \dots, l\} $,
$$
    (b_1, c] \supseteq (b_2, c] \supseteq \cdots \supseteq (a_k, c] \text{, with } b_1 \leq b_2 \leq \dots \leq b_k.
$$
As there is an injection between $ V $ and $ W$, Lemma \ref{lemma:inj-cardinalities} asures that the amount of bars in $ \barc(V) $ is lower that the amount in $ \barc(V) $, i.e., $ k \leq l $. We define the {\it injective induced matching} $\mu_{inj}\colon \barc(V) \to \barc(W) $ matching, for each $ c \in \R \cup \{\infty\} $, the intervals from both lists by decreasing length.

\begin{lemma}[Proposition 3.1.5, \cite{polterovich}] \label{lemma:inj-matching}
    If there exists an injection $\iota\colon (V, \pi) \in (W, \theta) $, then the induced matching $ \mu_{inj}\colon \barc(V) \to \barc (W) $ satisfies:
    \begin{enumerate}
        \item $\operatorname{coim} \mu_{inj} = \barc(V)$, \label{prop:3.1.5. 1}
        \item $\mu_{inj}(a, c] = (b, c], \ \forall b \leq a, \ \forall (a, d] \in \barc(V)$.
    \end{enumerate}
\end{lemma}
\begin{proof}
    Applying Lemma \ref{lemma:inj-cardinalities} with the interval $ (a_k, c] $, we have that for each $ c \in \R \cup \{\infty\} $, $ \# \barc_{(a_k, c]-}(V) \leq \# \barc_{(a_k, c]-}(W) $, having $ k \leq l $ as we note earlier. This means that every bar in $\barc(V)$ is matched to some bar in $\barc(W)$. Hence $\operatorname{coim} \mu_{inj} = \barc(V)$. Moreover, as the matching is carried out in length descending order, for each $ i \in \{1, \dots, k\} $, $\mu_{inj}(a_i, c] = (b_i, c]$, and applying Lemma \ref{lemma:inj-cardinalities}, now with the interval $ (a_i, c] $, and making the same reasoning, $ a_i \leq b_i $.
\end{proof}

Now we suppose that there exists a surjection $ \sigma\colon V \to W $. For every $ a \in \R$, sort the intervals $(a, c_i] \in \barc(V) $, $i \in \{1, \dots, k\} $ by decreasing length order as before,
$$
    (a, c_1] \supseteq (a, c_2] \supseteq \cdots \supseteq (a, c_k] \text{, with } c_1 \geq c_2 \geq \dots \geq a_k,
$$
and again in the same manner, sort the intervals $(a, d_j] \in \barc(V) $, $j \in \{1, \dots, l\} $,
$$
    (a, d_1] \supseteq (a, d_2] \supseteq \cdots \supseteq (a, d_l] \text{, with } d_1 \geq d_2 \geq \dots \geq d_l.
$$
We define the {\it surjective induced matching} $\mu_{sur}\colon \barc(V) \to \barc(W) $ matching, for each $ a \in \R $, the intervals from both lists by decreasing length.

\begin{lemma}[Exercise 3.1.8, \cite{polterovich}] \label{lemma:sur-matching}
    If there exists a surjection $s\colon (V, \pi) \to (W, \theta) $, then the induced matching $ \mu_{sur}\colon \barc(V) \to \barc (W) $ satisfies:
    \begin{enumerate}
        \item $\im \mu_{sur} = \barc(W)$,
        \item $\mu_{sur}(a, c] = (a, d], \ \forall c \geq d, \ \forall (a, d] \in \barc(V)$.
    \end{enumerate}
\end{lemma}
\begin{proof}
    Using Lemma \ref{lemma:sur-cardinalities} with the interval $(b, d_k]$ for each $ b \in \R $, we get that, as there exists a surjection between the modules, now $ k \geq l $. Therefore, every bar in $\barc(W)$ is matched to some bar in $\barc(V)$ and $\im \mu_{sur} = \barc(W)$. In an analogue way to the previous lemma, as the intervals in both lists are matched in a decreasing manner, for every $j \in \{1, \dots, l\} $, $\mu_{sur}(a, c_j] = (a, d_j] $, and if we now apply Lemma \ref{lemma:sur-cardinalities}, we get that $ c_j \geq d_j $.
\end{proof}

Hence, with the injective and the surjective induced matchings at hand, for a general morphism $ f $, we can define the {\it induced matching} $ \mu (f) \colon \barc(V) \to \barc(W) $, as the composition $ \mu_{inj} \circ \mu_{sur} $, defined as $ \im \mu_{sur} = \barc(\im f) = \operatorname{coim} \mu_{inj} $.

The following lemma verifies that, in fact, the mapping between persistence modules with its morphisms and barcodes with induced matchings (either the injective or the surjective versions) has functorial properties between the two categories.

\begin{lemma}[Claim 3.1.13, \cite{polterovich}] \label{lemma:functoriality}
    Let $ U$, $V$ and $W$ persistence diagrams and $f, g, h$ morphisms between them defined as in the following diagram:
    $$
        \begin{tikzcd}
            U \arrow[r, "f"] \arrow[rr, "h"', bend right] & V \arrow[r, "g"] & W
        \end{tikzcd}.
    $$
    If all $ f, g, h$ are all injections, or all surjections, then the corresponding diagram formed by the barcodes of the modules, and their respective matchings conmutes as well.
    $$
        \begin{tikzcd}
            \barc(U) \arrow[r, "\mu_*(f)"] \arrow[rr, "\mu_*(h)"', bend right] & \barc(V) \arrow[r, "\mu_*(g)"] & \barc(W)
        \end{tikzcd}.
    $$
    Where $ \mu_* $ denotes $ \mu_{inj} $ or $ \mu_{sur} $ accordingly.
\end{lemma}
\begin{proof}
    Let $f, g, h$ injective morphisms, by the definition of the injective induced matching and Lemma \ref{lemma:inj-cardinalities} for any $ d \in \R \cup \{+ \infty\}$, there exist $ k \leq l \leq q $ such that the barcodes of $ U, V, W$ consist on the following bars:
    \begin{align*}
        \barc(U):& (a_1, d] \supset \cdots \supset (a_k, d] \\
        \barc(V):& (b_1, d] \supset \cdots \supset (b_k, d] \supset \cdots \supset (b_l, d] \\
        \barc(V):& (c_1, d] \supset \cdots \supset (c_k, d] \supset \cdots \supset (c_l, d] \supset \cdots \supset (c_q, d]. \\
    \end{align*}
    Therefore, for any $ d $ the diagram conmutes as
    \begin{align*}
        \mu_{inj}(f)(a_i, d] = (b_i, d], \ \mu_{inj}(g)(b_i, d] = (c_i, d], \ \mu_{inj}(h)(a_i, d] = (c_i, d]
    \end{align*}
    for $ 1 \leq i \leq k$. If $f, g, h$ were surjective morphisms, an analogue reasoning using the surjective induced matching definition and Lemma \ref{lemma:sur-cardinalities} completes the proof.
\end{proof}

Finally, we can claim the two main lemmas from which we will construct our desired $\delta$-matching.

\begin{lemma}[Lemma 3.2.1, \cite{polterovich}] \label{lemma:sur-image}
    Let $ (V, \pi), (W, \theta) $ be $\delta$-interleaved persistence modules, with $\delta$-inter\-leaving morphisms $ \phi\colon V \to W_\delta $ and $ \psi\colon W \to V_\delta $. Let $ \phi\colon V \to \im\phi $ be a surjection and $ \mu_{sur}\colon \barc(V) \to \barc (\im \phi)$ the induced matching. Then
    \begin{enumerate}
        \item $\operatorname{coim} \mu_{sur} \supseteq \barc (V)_{\geq 2\delta} $,
        \item $ \im \mu_{sur} = \barc (\im \phi)$ and \label{}
        \item $ \mu_{sur}(b, d] = (b, d'], \ \forall (b, d] \in \operatorname{coim} \mu_{sur}, \ d' \in [d-2\delta, d]$.
    \end{enumerate}
\end{lemma}
\begin{proof}
\begin{enumerate}
    \item
    To check the first part, we observe that, in the following diagram, the three morphisms are surjective as $\phi$ and $\pi_{t \leq t+2\delta}$ are defined onto their images, and the diagram conmutes,
    $$
    \begin{tikzcd}
        V \arrow[r, "\phi"] \arrow[rr, "\pi_{t \leq t+2\delta}"', bend right] 
        & \im \phi \arrow[r, "\psi_\delta"] 
        & \im \pi_{t \leq t+2\delta} \\
    \end{tikzcd}.
    $$
    Therefore, because of Lemma \ref{lemma:functoriality} the barcode diagram also conmutes:
    $$
    \begin{tikzcd}
        \barc(V) \arrow[r, "\mu_{sur}(\phi)"] \arrow[rr, "\mu_{sur}(\pi_{t \leq t+2\delta})"', bend right] 
        & \barc(\im \phi) \arrow[r, "\mu_{sur}({\psi_\delta})"] 
        & \barc(\im \pi_{t \leq t+2\delta}) \\
    \end{tikzcd}.
    $$
    By the definition of the surjective induced matching,
    $$
        \operatorname{coim} \mu_{sur}(\pi_{t \leq t+2\delta}) = \barc(V)_{\geq 2\delta}.
    $$
    For each starting point $ a \in \R $, we have that
    $$
        \barc(\im \pi_{t \leq t+2\delta}) = \{ (a, b-2\delta] \colon (a, b]\in \barc(V), b-a > 2\delta\}.
    $$
    Sorting all bars of $\barc(V) $ and of $\barc(\im \pi_{t \leq t+2\delta}) $ in length-not-increasing order and matching the bars though the longest-first order, each bar $ (a, b] \in \barc(V) $ is matched with the bar $ (a, b - 2\delta] \in \barc(\im \pi_{t \leq t+2\delta}) $ while $ b -a >2 \delta $. The smaller bars are not matched. Thus,
    $$
        \operatorname{coim} \mu_{sur}(\phi) \supseteq \operatorname{coim} \mu_{sur}(\im \pi_{t \leq t+2\delta}) = \barc (V)_{\geq 2\delta}.
    $$

    \item
    The second part is just a reformulation of Lemma \ref{lemma:inj-cardinalities}.

    \item
    Let $ (b,d] \in \operatorname{coim} \mu_{sur}  $. There are two cases:

    On one hand, if $ d - b \leq 2 \delta $, $(b, d]$ is matched to $ (b, d'] $ where $ d \geq d'$, by definition of $ \mu_{sur} $. Also, $ d' > b $ and, as in this case we have $ b \geq d - 2 \delta $, we have $ d' > d - 2 \delta $. Therefore, $ d' \in [d - 2 \delta, d]$.

    On the other hand, if $ d - b > 2 \delta $, $(b, d]$ is matched to $ (b, d'] $ by $ \mu_{sur}(\phi)$, with $ (b, d'] \in W_{\leq 2 \delta}$. We can therefore use Lemma \ref{lemma:sur-matching} to check that $ d' \geq d$. In the same manner, $(b, d']$ is matched to $ (b, d''] $ by $ \mu_{sur}(\psi)_\delta $ with $ d'' \geq d' $. Finally, using the commutativity of the following diagram, we have that $ (b, d''] = (b, d - 2 \delta] $, making $ d' \in [d - 2 \delta, d]$.

    $$
    \begin{tikzcd}
    \barc(V)_{\geq 2 \delta}
    & \barc(\im \phi)
    & \barc(\im \pi_{t \leq t+2\delta}) \\
    (b, d] \arrow[r, mapsto, "\mu_{sur}(\phi)"] \arrow[u, phantom, "{\rotatebox{90}{$\in$}}"] \arrow[rrd, mapsto, bend right, "\mu_{sur}(\pi_{t \leq t+2\delta})" ]
    & (b, d'] \arrow[r, mapsto, "\mu_{sur}(\psi_\delta)"] \arrow[u, phantom, "{\rotatebox{90}{$\in$}}"]
    & (b, d''] \arrow[u, phantom, "{\rotatebox{90}{$\in$}}"] \\
    &
    & (b, d - 2 \delta] \arrow[u, phantom, "{\rotatebox{90}{$=$}}"]
    \end{tikzcd}
    $$
\end{enumerate}
\end{proof}

\begin{lemma}[Proposition 3.2.2, \cite{polterovich}] \label{lemma:inj-image}
    Let $ (V, \pi), (W, \theta) $ be $\delta$-interleaved persistence modules, with $\delta$-inter\-leaving morphisms $ \phi\colon V \to W_\delta $ and $ \psi\colon W \to V_\delta $. Let $ \phi\colon V \to \im\phi $ be an injection and $ \mu_{inj}\colon \barc(\im \phi) \to \barc (W_\delta)$ the induced matching. Then
    \begin{enumerate}
        \item $\operatorname{coim} \mu_{sur} = \barc (\im \phi) $,
        \item $ \im \mu_{inj} \supseteq \barc (W_\delta)_{\geq 2\delta} $ and
        \item $ \mu_{inj}(b, d'] = (b', d'], \ (b, d'] \in \operatorname{coim} \mu_{inj}, \ b' \in [b-2\delta, b]$.
    \end{enumerate}
\end{lemma}
\begin{proof}
\begin{enumerate}
    \item Immediate using Lemma \ref{lemma:inj-matching}.
    \item As $ \phi_\delta \circ \psi = \theta_{t \leq t+2\delta} $ the following diagram conmutes:
    $$
    \begin{tikzcd}
        W \arrow[r, "\psi"] \arrow[rr, "\theta_{t \leq t+2\delta}", bend right] 
        & \im \psi \arrow[r, "\phi_\delta"] 
        & W_{2\delta} \\
    \end{tikzcd}.
    $$
    This implies that $ \im \theta_{t \leq t+2\delta} \subseteq \im \phi_\delta \subseteq W_{2\delta} $, so there are some injections $ j $ and $ i $ which make the following diagram commute as well:
    $$
    \begin{tikzcd}
        \im \theta_{t \leq t+2\delta} \arrow[r, "j"] \arrow[rr, "\theta_{t \leq t+2\delta}"', bend right] 
        & \im \phi_\delta \arrow[r, "i"] 
        & W_{2\delta} \\
    \end{tikzcd}.
    $$
    As all morphisms in the diagram above are injections, we can use the functorial properties of Lemma \ref{lemma:functoriality} having a commutative diagram of the barcodes of each of the previous persistence modules:
    $$
    \begin{tikzcd}
        \barc(\im \theta_{t \leq t+2\delta}) \arrow[r, "\mu_{inj}(j)"] \arrow[rr, "\mu_{inj}(\theta_{t \leq t+2\delta})"', bend right] 
        & \barc(\im \phi_\delta) \arrow[r, "\mu_{inj}(i)"] 
        & \barc(W_{2\delta}) \\
    \end{tikzcd}.
    $$
    We have that
    \begin{align}
        \barc(\im \theta_{t \leq t+2\delta}) &= \{ (b, d-2 \delta) \colon (b, d] \in \barc(W), b < d - 2 \delta\}, \\
        \barc(W_{2 \delta}) &= \{ (b - 2 \delta, d - 2\delta) \colon (b, d] \in \barc(W) \} \text{ and } \\
        \mu_{inj}(\theta_{t \leq t+2\delta})((b, d-2 \delta)) &= (b - 2 \delta, 2 - 2\delta)
    \end{align}
    Therefore $ \im_\mu{inj}(i) \supseteq \im \mu_{inj}(\psi_{t \leq t+2\delta}) = \barc(W_{2 \delta})_{2 \delta}$. Thus, undoing the shifts, the proof is complete.

    \item Let $ (b, d] \in \barc(\im f_\delta) $ such as for some $ b' $, $ \mu_{inj}(b, d] = (b', d] \in \barc(W) $. Because of Lemma \ref{lemma:inj-matching}, $ b' \leq b $. There are again two cases:
    
    If $ d-b \leq 2 \delta $, then $ b' \geq d - 2\delta \geq b > b -2 \delta $ and $ b' \in [b - 2 \delta, b] $.

    Else, if $ d-b > 2 \delta $, there exists an interval $ (b' + 2\delta, d] \in \barc(\im \theta_{t \leq t+2\delta}) $ such that 
    $$
        \mu_{inj}(\theta_{t \leq t+2\delta})(b' + 2\delta, d] = \mu_{inj}(i)(b, d] = (a,d].
    $$
    Thus, $ b \leq b' + 2\delta $ and $ b' \in [b - 2 \delta, b] $.
\end{enumerate}
\end{proof}

At last, we can now prove the other part of the Stability theorem. For so, we will construct a $\delta$-matching out of a $\delta$-interleaving morphism.

\begin{proposition}[Theorem 3.0.2, \cite{polterovich}] \label{prop:matching-if-interleaving}
    Given two persistence modules $ V $, $ W $, with a $\delta$-interleaving morphism between them, then there is a $ \delta$-matching between their barcodes.
\end{proposition}
\begin{proof}
    Let $\mu(\phi) = \mu_{inj} \circ \mu_{sur} $ and let $ \Phi_\delta \colon \barc(W_\delta) \to \barc(W) $ be the {\it shift map} that carries each bar $ (a, b] $ into $ (a + \delta, b +\delta ]$. The composition $ \Phi_\delta \circ \mu(\phi) $ is a matching between $ \barc(V) $ and $ \barc(W) $. Hence, using Lemma \ref{lemma:inj-image} and \ref{lemma:sur-image}, we get the following diagram:
    $$
    \begin{tikzcd}[column sep=large, row sep=large]
        \barc(V)
        &
        & \barc(W_\delta)_{\geq 2 \delta} 
        & \barc(W)_{\geq 2 \delta} \\
        \barc(V)_{\geq 2\delta} \arrow[r, "\mu_{sur}"] \arrow[u, phantom, "{\rotatebox{90}{$\subseteq$}}" description]
        & \barc(\im f) \arrow[r, "\mu_{inj}"]
        & \im \mu_{inj} \arrow[r, "\Psi_\delta"] \arrow[u, phantom, "{\rotatebox{90}{$\supseteq$}}" description]
        & \barc{B}(W) \arrow[u, phantom, "{\rotatebox{90}{$\supseteq$}}" description]\\
        (b, d] \arrow[r, mapsto] \arrow[u, phantom, "{\rotatebox{90}{$\in$}}"]
        & (b, d'] \arrow[r, mapsto] \arrow[u, phantom, "{\rotatebox{90}{$\in$}}"]
        & (b', d'] \arrow[r, mapsto] \arrow[u, phantom, "{\rotatebox{90}{$\in$}}"] 
        & (b' + \delta, d' + \delta] \arrow[u, phantom, "{\rotatebox{90}{$\in$}}"]
    \end{tikzcd}
    $$
    The diagram shows that, by Lemma \ref{lemma:sur-image}, a bar $ (b, d] \in \barc(V)_{\geq 2\delta} $ is sent to $ \mu_{sur}(b, d] = (b, d'] \in \barc(\im \phi) $ with $ d' \in [d - 2 \delta, d] $. Then, by Lemma \ref{lemma:sur-image}, it is sent to $ \mu_{sur}(b, d'] = (b', d'] $ with $ b' \in [b - 2 \delta, b] $. At last, using the shift morphism $ \Phi_\delta$ it is carried to $(b' + \delta, d' + \delta] $.

    This shows that any bar in $ \barc(V)_{\geq 2\delta} $ is matched. In the same manner it can be seen that any bar in $ \barc(W)_{\geq 2\delta} $ is matched. Thus, we have that
    $$
        \begin{cases}
            d - 2\delta \leq d' \leq d\\
            b - 2\delta \leq b' \leq b
        \end{cases}
        \Rightarrow
        \begin{cases}
            d - \delta \leq d' + \delta \leq d + \delta \\
            b - \delta \leq b' + \delta \leq b + \delta 
        \end{cases},
    $$
    and therefore, $ \Phi_\delta \circ \mu(\phi) $ is a $\delta$-matching between $ \barc(V) $ and $ \barc(W) $.
\end{proof}

The constructions made by Proposition \ref{prop:interleaving-if-matching} and Proposition \ref{prop:matching-if-interleaving} asure that given a $\delta$-interleaving morphism we can build a $\delta$-matching, and conversely, given a $\delta$-matching we can build a $\delta$-interleaving morphism. This means that if one of the two exists, it fixes a $\delta$. Both the interleaving distance and the bottleneck distance try to minimice this $\delta$, so once fixed for one of them, the other needs an smaller or equal $\delta'$. Thus, with each of the propositions we can prove one of the inequalities needed to reach the isomorphism between the space of persistence diagrams and the space of their barcodes.

\Stability*
\begin{proof}
    Suppose $ d_{int}(V, W) = \delta $. Proposition \ref{prop:matching-if-interleaving} asures there exist a $\delta$-matching between $ \barc(V) $ and $ \barc (W) $. As $ d_{bot}(V, W) $ is the infimum $\delta$ for witch exists a $\delta$-matching, $ d_{bot}(V, W) \leq d_{int}(V, W)$. On the other hand, Proposition \ref{prop:interleaving-if-matching} leads, with the same reasoning, to $ d_{int}(V, W) \leq d_{bot}(V, W)$. Thus, it has to be $ d_{int} (V, W) = d_{bot} (\barc(V), \barc(W)) $.
\end{proof}